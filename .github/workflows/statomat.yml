name: statomat
on:
  issues:
    types: [labeled]
jobs:
  setstatus:
    runs-on: ubuntu-latest
    steps:
      - name: Find component label
        id: component-label
        run: |
          echo "${{github.event.issue.labels}}"
          issue_labels=$(jq '.name' "${{github.event.issue.labels}}")
          for label in $issue_labels; do
            if [[ $label == component* ]]; then
              echo "Label $label is a component label."
              echo "label=$label" >> $GITHUB_OUTPUT
              exit 0
            fi
          done

      - name: Find base issue
        id: base-issue
        run: |
          echo ${{ steps.component-label.outputs }}
          echo ${{ steps.component-label.outputs.label }}
          LABEL1= ${{ steps.component-label.outputs.label }}
          LABEL2='base'
          ISSUE_SEARCH_RESULT=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" https://api.github.com/search/issues?q=label:$LABEL1+label:$LABEL2)
          echo $ISSUE_SEARCH_RESULT
